(this["webpackJsonpmoney-flow"]=this["webpackJsonpmoney-flow"]||[]).push([[0],{269:function(e,t,n){"use strict";(function(e){var r=n(45),i=n(9),a=n(10),o=n(28),l=n.n(o),u=n(270),c=n.n(u),s=n(271),d=function(){function t(){Object(i.a)(this,t),this.db=null}return Object(a.a)(t,[{key:"init",value:function(){var e=Object(r.a)(l.a.mark((function e(t){var n,r,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c()({locateFile:function(){return s.a}});case 2:return n=e.sent,e.next=5,new Promise((function(e,n){var r=new FileReader;r.readAsArrayBuffer(t),r.onload=function(){return e(r.result)}}));case 5:r=e.sent,i=new Uint8Array(r),this.db=new n.Database(i);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"export",value:function(){var t=this.db.export(),n=e.from(t),r=new Blob([n]),i=window.URL.createObjectURL(r);this.downloadFile(i)}},{key:"downloadFile",value:function(e){console.log("\u4e0b\u8f7d\u6587\u4ef6\uff1a"+e);var t=document.createElement("a");document.body.appendChild(t),t.href=e,t.download="data.db",t.onclick=function(){setTimeout((function(){window.URL.revokeObjectURL(t.href)}),1500)},t.click()}},{key:"selectAll",value:function(e){return this.select(e,[],[],[])}},{key:"select",value:function(e,t,n,r){return this.selectAndOrder(e,t,n,r,[])}},{key:"selectAndOrder",value:function(e,t,n,r,i){var a="SELECT * FROM ".concat(e),o=this.genWhereSql(t,n,r),l=o[1];return a+=o[0],i.length>0&&(a+=" order by ".concat(i.join(","))),console.log(a+" "+JSON.stringify(l)),this.db.exec(a,l)}},{key:"insert",value:function(e,t,n){for(var r="INSERT INTO ".concat(e," (").concat(t.join(","),") VALUES ("),i={},a=0;a<t.length;a++)r+="$"+t[a]+a,a<t.length-1&&(r+=", "),i["$"+t[a]+a]=n[a];return r+=") returning id",console.log(r+" "+JSON.stringify(i)),this.db.exec(r,i)[0].values[0][0]}},{key:"update",value:function(e,t,n,r){var i="UPDATE ".concat(e," SET"),a=this.genSubSql(n,r,[],!1),o=a[1];i+=a[0],i+=" where id=$id",o.$id=t,console.log(i+" "+JSON.stringify(o)),this.db.run(i,o)}},{key:"deleteAll",value:function(e){this.delete(e,[],[],[])}},{key:"delete",value:function(e,t,n,r){var i="DELETE FROM ".concat(e),a=this.genWhereSql(t,n,r),o=a[1];i+=a[0],console.log(i+" "+JSON.stringify(o));var l=this.db.exec(i,o);console.log(JSON.stringify(l))}},{key:"genWhereSql",value:function(e,t,n){return this.genSubSql(e,t,n,!0)}},{key:"genSubSql",value:function(e,t,n,r){for(var i="",a={},o=0;o<e.length;o++){i+=0!==o?r?" and ":" , ":r?" where ":" ";var l=n[o];void 0===l&&(l="="),i+=" "+e[o]+" "+l+" $"+e[o]+o,a["$"+e[o]+o]=t[o]}return[i,a]}}]),t}();t.a=d}).call(this,n(39).Buffer)},286:function(e,t,n){},367:function(e,t){},369:function(e,t){},380:function(e,t){},382:function(e,t){},409:function(e,t){},411:function(e,t){},412:function(e,t){},417:function(e,t){},419:function(e,t){},425:function(e,t){},427:function(e,t){},446:function(e,t){},458:function(e,t){},461:function(e,t){},469:function(e,t,n){"use strict";n.r(t),n.d(t,"App",(function(){return _e})),n.d(t,"DB_INIT",(function(){return Ee}));var r=n(45),i=n(9),a=n(10),o=n(28),l=n.n(o),u=n(0),c=n.n(u),s=n(50),d=n.n(s),y=(n(286),n(3)),h=n(14),f=n(13),v=n(480),p=n(43),b=n(474),m=n(473),j=n(476),g=function(){function e(){Object(i.a)(this,e)}return Object(a.a)(e,null,[{key:"getStr",value:function(e){if(x.isEmpty(e)||x.notNumber(e)||0==e)return"-";var t=e/100;return"\uffe5".concat(t%1===0?t:t.toFixed(2))}},{key:"compare",value:function(e,t){return x.notNumber(e)?-1:x.notNumber(t)?1:e-t}},{key:"safeDivision",value:function(e,t){return x.notNumber(e)||x.notNumber(t)||0==t?null:e/t}}]),e}(),x=function(){function e(){Object(i.a)(this,e)}return Object(a.a)(e,null,[{key:"isEmpty",value:function(e){return void 0===e||null===e||""===e}},{key:"isNull",value:function(e){return void 0===e||null===e}},{key:"notNumber",value:function(e){return this.isNull(e)||isNaN(e)}},{key:"getPercent",value:function(e){var t=100*e;return"".concat(t%1===0?t:t.toFixed(2),"%")}}]),e}(),O=function(){function e(){Object(i.a)(this,e)}return Object(a.a)(e,null,[{key:"nextMonthStart",value:function(e){var t=e.getMonth()+1,n=e.getFullYear();return 12===t?(n+=1,t="01"):t=(t+=1)<10?"0"+t:t,new Date("".concat(n,"-").concat(t,"-01 00:00:00"))}},{key:"monthEnd",value:function(e){return new Date(this.nextMonthStart(e)-1)}},{key:"monthStart",value:function(e){var t=e.getMonth()+1,n=e.getFullYear();return new Date("".concat(n,"-").concat(t,"-01 00:00:00"))}},{key:"lastMonthEnd",value:function(e){return new Date(this.monthStart(e)-1)}},{key:"inMonth",value:function(t,n){var r=e.monthStart(n);return!(t>e.monthEnd(n)||t<r)}},{key:"dayStr",value:function(e){return x.isNull(e)?"":e.timeStr().substring(0,10)}},{key:"monthStr",value:function(e){return e.timeStr().substring(0,7)}},{key:"weekDayStr",value:function(e){switch(e.getDay()){case 0:return"\u5468\u65e5";case 1:return"\u5468\u4e00";case 2:return"\u5468\u4e8c";case 3:return"\u5468\u4e09";case 4:return"\u5468\u56db";case 5:return"\u5468\u4e94";case 6:return"\u5468\u516d"}}}]),e}(),k=n(40),S=function(){function e(){Object(i.a)(this,e),this.tablename=null,Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e},Date.prototype.timeStr=function(){return this.format("yyyy-MM-dd hh:mm:ss")}}return Object(a.a)(e,[{key:"get",value:function(e){if(!Ee)return null;if(null!=e)return this.convert(_e.db.select(this.tablename,["id"],[e],[]));throw new Error("id \u4e0d\u80fd\u4e3a\u7a7a")}},{key:"selectAll",value:function(){return Ee?this.convert(_e.db.selectAll(this.tablename)):[]}},{key:"delete",value:function(e){Ee&&_e.db.delete(this.tablename,["id"],[e],[])}},{key:"deleteAll",value:function(){Ee&&_e.db.deleteAll(this.tablename)}},{key:"convert",value:function(e){}}],[{key:"getDateStr",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==e){if(t)return(new Date).timeStr();throw new Error("\u65e5\u671f\u4e0d\u80fd\u4e3a null")}if(e instanceof Date)return e.timeStr();throw new Error("\u65e5\u671f\u683c\u5f0f\u4e0d\u4e3a Date")}}]),e}(),w=Object(a.a)((function e(){Object(i.a)(this,e),this.id=null,this.gmtCreate=null,this.gmtModified=null})),M=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).tablename="income_expenditure_detail",e}return Object(a.a)(n,[{key:"upsert",value:function(e){var t,n,r=S.getDateStr(e.gmtCreate,!0),i=S.getDateStr(e.gmtModified),a=S.getDateStr(e.happenTime);null==e.id?null===(t=_e.db)||void 0===t||t.insert(this.tablename,["gmt_create","gmt_modified","type","desc","money","happen_time"],[r,i,e.type.code,e.desc,e.money,a]):null===(n=_e.db)||void 0===n||n.update(this.tablename,e.id,["gmt_create","gmt_modified","type","desc","money","happen_time"],[r,i,e.type.code,e.desc,e.money,a])}},{key:"select",value:function(e,t){var n;if(t<e)throw new Error("\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65f6\u95f4");return this.convert(null===(n=_e.db)||void 0===n?void 0:n.select(this.tablename,["happen_time","happen_time"],[e.timeStr(),t.timeStr()],[">","<"]))}},{key:"convert",value:function(e){var t=[];if(void 0===e||void 0===e[0])return t;var n,r=Object(k.a)(e[0].values);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=new P;a.id=i[0],a.gmtCreate=new Date(i[1]),a.gmtModified=new Date(i[2]),a.type=D.getByCode(i[3]),a.desc=i[4],a.money=i[5],a.happenTime=new Date(i[6]),t.push(a)}}catch(o){r.e(o)}finally{r.f()}return t}}]),n}(S),P=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).type=null,e.desc=null,e.money=null,e.happenTime=null,e}return Object(a.a)(n,[{key:"save",value:function(){this.gmtModified=new Date,this.money*this.type.code<0&&(this.money=-1*this.money),n.repo.upsert(this)}}],[{key:"query",value:function(e){return this.repo.get(e)}},{key:"queryTimeBetwen",value:function(e,t){return this.repo.select(e,t)}},{key:"delete",value:function(e){n.repo.delete(e)}}]),n}(w);P.repo=new M;var D=function(){function e(t,n){Object(i.a)(this,e),this.code=t,this.name=n}return Object(a.a)(e,null,[{key:"getByCode",value:function(e){var t,n=Object(k.a)(this.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.code==e)return r}}catch(i){n.e(i)}finally{n.f()}return null}},{key:"toList",value:function(t){if(t instanceof e)return[t];for(var n=[],r=0,i=Object.keys(t);r<i.length;r++){var a=i[r];n=n.concat(this.toList(t[a]))}return n}},{key:"values",value:function(){return this.toList(this.Incomme).concat(this.toList(this.Expenditure))}}]),e}();D.Incomme={salary:{self:new D(1e4,"\u85aa\u6c34"),num13:new D(10001,"\u85aa\u6c34-\u5341\u4e09\u85aa"),bonus:new D(10002,"\u85aa\u6c34-\u5e74\u7ec8\u5956")},luckmoney:{self:new D(2e4,"\u7ea2\u5305"),work:new D(20001,"\u7ea2\u5305-\u5de5\u4f5c"),home:new D(20002,"\u7ea2\u5305-\u5bb6\u4eba")},other:{self:new D(3e4,"\u5176\u4ed6")}},D.Expenditure={home:{self:new D(-1e4,"\u4f4f\u623f"),rent:new D(-10001,"\u4f4f\u623f-\u623f\u79df"),utility:new D(-10002,"\u4f4f\u623f-\u6c34\u7535")},daily:{self:new D(-2e4,"\u65e5\u5e38"),taxi:new D(-20001,"\u65e5\u5e38-\u4ea4\u901a"),phone:new D(-20002,"\u65e5\u5e38-\u8bdd\u8d39")},shopping:{self:new D(-3e4,"\u8d2d\u7269"),elc:new D(-30001,"\u8d2d\u7269-\u7535\u5b50"),life:new D(-30002,"\u8d2d\u7269-\u751f\u6d3b")},happy:{self:new D(-4e4,"\u5a31\u4e50"),online:new D(-40001,"\u5a31\u4e50-\u7ebf\u4e0a"),offline:new D(-40002,"\u5a31\u4e50-\u7ebf\u4e0b")},food:{self:new D(-5e4,"\u9910\u996e"),canteen:new D(-50001,"\u9910\u996e-\u98df\u5802"),out:new D(-50002,"\u9910\u996e-\u5916\u51fa")},family:{self:new D(-6e4,"\u5bb6\u4eba"),traval:new D(-60001,"\u5bb6\u4eba-\u4ea4\u901a"),gift:new D(-60002,"\u5bb6\u4eba-\u793c\u7269")},study:{self:new D(-7e4,"\u5b66\u4e60"),online:new D(-70001,"\u5b66\u4e60-\u7ebf\u4e0a"),offline:new D(-70002,"\u5b66\u4e60-\u7ebf\u4e0b")},health:{self:new D(-8e4,"\u5065\u5eb7")},car:{self:new D(-9e4,"\u8f66"),etc:new D(-90001,"\u8f66-\u505c\u8f66/ETC"),oil:new D(-90002,"\u8f66-\u52a0\u6cb9")},girlfriend:{self:new D(-1e5,"\u5973\u670b\u53cb"),traval:new D(-100001,"\u5973\u670b\u53cb-\u65c5\u6e38"),eat:new D(-100002,"\u5973\u670b\u53cb-\u5403\u559d"),gift:new D(-100003,"\u5973\u670b\u53cb-\u793c\u7269")},other:{self:new D(-11e4,"\u5176\u4ed6")}};var I=function(){function e(){Object(i.a)(this,e)}return Object(a.a)(e,null,[{key:"getIncomeTypes",value:function(){return D.Incomme}},{key:"getExpenditureTypes",value:function(){return D.Expenditure}},{key:"upsert",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=new P;a.id=i,a.type=t,a.desc=r,a.money=e,a.happenTime=n,a.save()}},{key:"queryMonth",value:function(e){var t=O.monthStart(e);return P.queryTimeBetwen(t,O.monthEnd(t))}},{key:"delete",value:function(e){P.delete(e)}}]),e}(),C=n(6),T=(j.a.Title,j.a.Paragraph,j.a.Text,j.a.Link,c.a.Component,n(470)),N=n(275),E=n(108),_=n(115),q=n(67),B=n(479),A=n(131),R=n(278),L=n(481),K=n(472),V=n(471),F=n(1),z=n(274),H=n(477),Y=n(475),$=n(56),J=n.n($),U=A.a.Option,W=(T.a.Header,T.a.Content,T.a.Sider,j.a.Title,j.a.Paragraph,j.a.Text),G=(j.a.Link,["type","name","desc","money","currentPrice","currentProfit","sellProfit","count","date"]),Q=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).state=r.getInitialState(),r}return Object(a.a)(n,[{key:"getInitialState",value:function(){var e={};return G.forEach((function(t){e[t]=null})),e}},{key:"getOpts",value:function(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];t.push(Object(C.jsx)(U,{value:i,children:e[i][0]},i))}return t}},{key:"itemToWidget",value:function(e){var t,n,r,i,a,o=this,l=e.name,u=null!==(t=e.required)&&void 0!==t&&t?"(\u5fc5\u586b)":"",c="",s=e.defaultValue;switch(x.isNull(this.state[l])&&!x.isNull(s)&&(this.state[l]=s),e.name){case"type":var d=l+"Name",y=l+"ParentCode",h=l+"ParentName",f=this.getOpts(e.code2Name);return Object(C.jsxs)(_.a,{align:"middle",children:[Object(C.jsx)(q.a,{span:8,children:Object(C.jsxs)(W,{children:["\u7c7b\u578b",u,":"]})}),Object(C.jsx)(q.a,{flex:"auto",align:"center",children:Object(C.jsx)(A.a,{style:{width:"150px"},value:this.state[l],onChange:function(t){var n;o.setState((n={},Object(F.a)(n,l,t),Object(F.a)(n,d,e.code2Name[t][0]),Object(F.a)(n,y,e.code2Name[t][1]),Object(F.a)(n,h,e.code2Name[t][2]),n))},children:f})})]});case"name":return Object(C.jsxs)(_.a,{align:"middle",style:{margin:"10px 0"},children:[Object(C.jsx)(q.a,{span:8,children:Object(C.jsxs)(W,{children:["\u540d\u79f0",u,":"]})}),Object(C.jsx)(q.a,{flex:"auto",align:"center",children:Object(C.jsx)(z.a,{placeholder:"\u540d\u79f0",style:{width:"150px"},value:this.state[l],onChange:function(e){o.setState(Object(F.a)({},l,e.target.value))}})})]});case"money":case"currentPrice":case"currentProfit":case"sellProfit":case"count":var v=e.moneyPon;c=null!==(n=e.hint)&&void 0!==n?n:"\u91d1\u989d";var p=l+"Pon";return this.state[p]=v,Object(C.jsxs)(_.a,{align:"middle",style:{margin:"10px 0"},children:[Object(C.jsx)(q.a,{span:8,children:Object(C.jsxs)(W,{children:[c,u,":"]})}),Object(C.jsx)(q.a,{flex:"auto",align:"center",children:Object(C.jsx)(H.a,{style:{width:"150px"},addonBefore:v?"+":"-",value:this.state[l],onChange:function(e){o.setState(Object(F.a)({},l,e))}})})]});case"date":x.isNull(e.inMonth)||!x.isNull(this.state[l])&&O.inMonth(this.state[l],new Date(e.inMonth))||(this.state[l]=new Date(e.inMonth)),c=null!==(r=e.hint)&&void 0!==r?r:"\u53d1\u751f\u65e5\u671f";var b=null!==(i=e.picker)&&void 0!==i?i:"";return Object(C.jsxs)(_.a,{align:"middle",style:{margin:"10px 0"},children:[Object(C.jsx)(q.a,{span:8,children:Object(C.jsxs)(W,{children:[c,u,":"]})}),Object(C.jsx)(q.a,{flex:"auto",align:"center",children:Object(C.jsx)(m.a,{style:{width:"150px"},picker:b,value:J()(this.state[l]),onChange:function(e,t){o.setState(Object(F.a)({},l,e.toDate()))}})})]});case"desc":return c=null!==(a=e.hint)&&void 0!==a?a:"\u63cf\u8ff0",Object(C.jsxs)(_.a,{align:"middle",style:{margin:"10px 0"},children:[Object(C.jsx)(q.a,{span:8,children:Object(C.jsxs)(W,{children:[c,u,":"]})}),Object(C.jsx)(q.a,{flex:"auto",align:"center",children:Object(C.jsx)(z.a,{placeholder:"\u63cf\u8ff0",style:{width:"150px"},value:this.state[l],onChange:function(e){o.setState(Object(F.a)({},l,e.target.value))}})})]});default:return Object(C.jsx)(_.a,{children:Object(C.jsxs)(W,{children:["\u672a\u652f\u6301\u8f93\u5165\u914d\u7f6e ",e.name]})})}}},{key:"checkData",value:function(e,t){try{var n=e[t.name];if(!0===t.required&&x.isNull(n))throw new Error(t.name+" \u5fc5\u987b\u8f93\u5165");if(!0===t.isNum&&isNaN(n))throw new Error(t.name+" \u5fc5\u987b\u4e3a\u6570\u5b57");if(!x.isNull(t.inMonth)&&!O.inMonth(n,new Date(t.inMonth)))throw new Error("\u53d1\u751f\u65e5\u671f\u4ec5\u53ef\u9009\u5728\u5f53\u524d\u6708\u4efd\uff1a"+t.inMonth);return!0}catch(r){return console.warn(r),alert(r),!1}}},{key:"render",value:function(){var e,t,n=this,r=[],i=Object(k.a)(this.props.cfgs);try{for(i.s();!(t=i.n()).done;){var a=t.value;r.push(this.itemToWidget(a))}}catch(o){i.e(o)}finally{i.f()}return Object(C.jsxs)(Y.a,{title:null!==(e=this.props.title)&&void 0!==e?e:"\u65b0\u589e",style:{margin:"0px 5px"},bodyStyle:{padding:"25px"},children:[r,Object(C.jsx)(_.a,{justify:"center",style:{margin:"15px 0 0 0"},children:Object(C.jsx)(q.a,{children:Object(C.jsx)(p.a,{type:"primary",onClick:function(){var e,t=Object(k.a)(n.props.cfgs);try{for(t.s();!(e=t.n()).done;){var r=e.value;if(!n.checkData(n.state,r))return}}catch(o){t.e(o)}finally{t.f()}n.props.onSubmit(n.state)&&n.setState(n.getInitialState())},children:" \u63d0\u4ea4 "})})})]})}}],[{key:"getMoney",value:function(e,t){var n=e[t+"Pon"]?1:-1;return x.notNumber(e[t])?NaN:e[t]*n*100}}]),n}(c.a.Component),X=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).tablename="investment_product",e}return Object(a.a)(n,[{key:"upsert",value:function(e){var t,n,r=S.getDateStr(e.gmtCreate,!0),i=S.getDateStr(e.gmtModified);null==e.id?null===(t=_e.db)||void 0===t||t.insert(this.tablename,["gmt_create","gmt_modified","name","type","desc","fix_vote"],[r,i,e.name,e.type.code,e.desc,e.fixVote]):null===(n=_e.db)||void 0===n||n.update(this.tablename,e.id,["gmt_create","gmt_modified","name","type","desc","fix_vote"],[r,i,e.name,e.type.code,e.desc,e.fixVote])}},{key:"convert",value:function(e){var t=[];if(void 0===e||void 0===e[0])return t;var n,r=Object(k.a)(e[0].values);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=new ee;a.id=i[0],a.gmtCreate=new Date(i[1]),a.gmtModified=new Date(i[2]),a.name=i[3],a.type=re.getByCode(i[4]),a.desc=i[5],a.fixVote=i[6],t.push(a)}}catch(o){r.e(o)}finally{r.f()}return t}}]),n}(S),Z=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).tablename="investment_detail",e}return Object(a.a)(n,[{key:"upsert",value:function(e){var t,n,r=S.getDateStr(e.gmtCreate,!0),i=S.getDateStr(e.gmtModified),a=S.getDateStr(e.happenTime);return null==e.id?null===(t=_e.db)||void 0===t?void 0:t.insert(this.tablename,["gmt_create","gmt_modified","product_id","product_name","product_type","money","happen_time","buy_sell_id","record_type","count"],[r,i,e.productId,e.productName,e.productType.code,e.money,a,e.buySellId,e.recordType.code,e.count]):(null===(n=_e.db)||void 0===n||n.update(this.tablename,e.id,["gmt_create","gmt_modified","product_id","product_name","product_type","money","happen_time","buy_sell_id","record_type","count"],[r,i,e.productId,e.productName,e.productType.code,e.money,a,e.buySellId,e.recordType.code,e.count]),e.id)}},{key:"select",value:function(e,t,n,r){var i;if(!Ee)return[];if(null!=n&&r<n)throw new Error("\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u65f6\u95f4");var a=[],o=[],l=[];return null!=e&&(a.push("product_id"),o.push(e),l.push("=")),null!=t&&(a.push("record_type"),o.push(t.code),l.push("=")),null!=n&&(a.push("happen_time"),o.push(n.timeStr()),l.push(">")),null!=r&&(a.push("happen_time"),o.push(r.timeStr()),l.push("<")),this.convert(null===(i=_e.db)||void 0===i?void 0:i.selectAndOrder(this.tablename,a,o,l,["happen_time desc","gmt_modified desc"]))}},{key:"selectBySellId",value:function(e){var t;return this.convert(null===(t=_e.db)||void 0===t?void 0:t.select(this.tablename,["buy_sell_id"],[e],["="]))}},{key:"deleteBySellId",value:function(e){var t;null===(t=_e.db)||void 0===t||t.delete(this.tablename,["buy_sell_id"],[e],["="])}},{key:"convert",value:function(e){var t=[];if(void 0===e||void 0===e[0])return t;var n,r=Object(k.a)(e[0].values);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=new te;a.id=i[0],a.gmtCreate=new Date(i[1]),a.gmtModified=new Date(i[2]),a.productId=i[3],a.productName=i[4],a.productType=re.getByCode(i[5]),a.money=i[6],a.happenTime=new Date(i[7]),a.buySellId=i[8],a.recordType=ne.getByCode(i[9]),a.count=i[10],t.push(a)}}catch(o){r.e(o)}finally{r.f()}return t}}]),n}(S),ee=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name=null,e.type=null,e.desc=null,e.fixVote=null,e}return Object(a.a)(n,[{key:"save",value:function(){this.gmtModified=new Date,x.isNull(this.fixVote)&&(this.fixVote=0),n.repo.upsert(this)}}],[{key:"queryAll",value:function(){return this.repo.selectAll()}},{key:"delete",value:function(e){n.repo.delete(e)}}]),n}(w);ee.repo=new X;var te=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).productId=null,e.productName=null,e.productType=null,e.money=null,e.count=null,e.happenTime=null,e.buySellId=null,e.recordType=null,e}return Object(a.a)(n,[{key:"save",value:function(){return this.gmtModified=new Date,n.repo.upsert(this)}},{key:"delete",value:function(){this.recordType.code===ne.BuySell.code&&n.repo.deleteBySellId(this.id),n.repo.delete(this.id)}}],[{key:"query",value:function(e){return this.repo.get(e)}},{key:"queryTimeBetwen",value:function(e,t,n,r){return this.repo.select(e,t,n,r)}}]),n}(w);te.repo=new Z;var ne=function(){function e(t,n){Object(i.a)(this,e),this.code=t,this.name=n}return Object(a.a)(e,null,[{key:"getByCode",value:function(e){var t,n=Object(k.a)(this.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.code==e)return r}}catch(i){n.e(i)}finally{n.f()}return null}},{key:"values",value:function(){return[this.BuySell,this.CurrentPrice,this.Profit,this.AssetDebtCurrentPrice,this.AssetDebtProfit]}}]),e}();ne.BuySell=new ne(1,"\u4e70\u5165\u6216\u5356\u51fa"),ne.CurrentPrice=new ne(2,"\u6295\u8d44\u7c7b\u73b0\u4ef7"),ne.Profit=new ne(3,"\u6295\u8d44\u7c7b\u6536\u76ca"),ne.AssetDebtCurrentPrice=new ne(4,"\u8d44\u4ea7/\u8d1f\u503a\u7c7b\u73b0\u4ef7"),ne.AssetDebtProfit=new ne(5,"\u8d44\u4ea7/\u8d1f\u503a\u7c7b\u6536\u76ca");var re=function(){function e(t,n){Object(i.a)(this,e),this.code=t,this.name=n}return Object(a.a)(e,[{key:"isAsset",value:function(){return this===e.Product.saving}},{key:"isDebt",value:function(){return this===e.Product.debt}}],[{key:"getByCode",value:function(e){var t,n=Object(k.a)(this.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.code==e)return r}}catch(i){n.e(i)}finally{n.f()}return null}},{key:"toList",value:function(t){if(t instanceof e)return[t];for(var n=[],r=0,i=Object.keys(t);r<i.length;r++){var a=i[r];n=n.concat(this.toList(t[a]))}return n}},{key:"values",value:function(){return this.toList(this.Product)}}]),e}();re.Product={saving:new re(1e6,"\u73b0\u91d1\u7c7b\u8d44\u4ea7"),stock_fund:new re(2e6,"\u80a1\u7968\u7c7b\u57fa\u91d1"),etf:new re(3e6,"\u6307\u6570\u7c7b\u57fa\u91d1"),bond:new re(4e6,"\u503a\u5238\u7c7b\u57fa\u91d1"),stock:new re(5e6,"\u80a1\u7968"),debt:new re(6e6,"\u8d1f\u503a")};var ie=function(){function e(){Object(i.a)(this,e)}return Object(a.a)(e,null,[{key:"getProductTypes",value:function(){return re.toList(re.Product)}},{key:"upsertProduct",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=new ee;i.id=r,i.type=re.getByCode(e),i.desc=n,i.name=t,i.save()}},{key:"queryProducts",value:function(){return ee.queryAll()}},{key:"editProduct",value:function(e,t,n){e.fixVote=n,e.desc=t,e.save()}},{key:"deleteProduct",value:function(e){ee.delete(e.id)}},{key:"getAllInvestDetailBefore",value:function(e){var t=this,n=te.queryTimeBetwen(null,null,null,e),r={invest:{},asset:{},debt:{}};return n.forEach((function(e){t.dealDetail(e,r)})),r}},{key:"dealDetail",value:function(e,t){var n=null;return n=e.productType.isAsset()?t.asset:e.productType.isDebt()?t.debt:t.invest,x.isNull(n[e.productId])&&(n[e.productId]={}),(n=n[e.productId]).info=e,e.recordType==ne.CurrentPrice||e.recordType==ne.AssetDebtCurrentPrice?void 0===n.currentPrice&&(n.currentPrice=e):e.recordType==ne.Profit||e.recordType==ne.AssetDebtProfit?(x.isNull(n.profits)&&(n.profits={totalMoney:0,datas:[]}),n.profits.totalMoney+=e.money,n.profits.datas.push(e)):e.recordType==ne.BuySell&&(x.isNull(n.buySells)&&(n.buySells={totalMoney:0,totalCount:0,datas:[]}),x.notNumber(e.count)||(n.buySells.totalCount+=e.count),n.buySells.totalMoney+=e.money,n.buySells.datas.push(e)),t}},{key:"getProductTotalBuySellBefore",value:function(e,t){return te.queryTimeBetwen(e,ne.BuySell,null,t)}},{key:"addAssetDebtProfit",value:function(e,t,n,r,i,a){x.notNumber(r)||0==r||this._upsertInvest(e,t,n,r,a,ne.AssetDebtProfit),this._upsertInvest(e,t,n,i,a,ne.AssetDebtCurrentPrice)}},{key:"addBuyInvest",value:function(e,t,n,r,i,a,o){var l=this._upsertInvest(e,t,n,i,o,ne.BuySell,r);this._upsertInvest(e,t,n,a,o,ne.CurrentPrice,null,l)}},{key:"addSellInvest",value:function(e,t,n,r,i,a,o,l){var u=0;this.getProductTotalBuySellBefore(e,new Date(l.getTime()+1e3)).forEach((function(e){u+=e.money}));var c=u-(a-o),s=i-c;console.log("totalInvestMoney: ".concat(u," currentProfit: ").concat(o," currentPrice: ").concat(a," principal: ").concat(c," sellGetMoney: ").concat(i," sellProfit: ").concat(s)),this.addSellInvestOfProfit(e,t,n,r,i,s,a,l)}},{key:"addSellInvestOfProfit",value:function(e,t,n,r,i,a,o,l){var u=i-a;x.notNumber(r)||(r*=-1);var c=this._upsertInvest(e,t,n,-1*u,l,ne.BuySell,r);o>=0&&this._upsertInvest(e,t,n,o,l,ne.CurrentPrice,null,c),this._upsertInvest(e,t,n,a,l,ne.Profit,null,c)}},{key:"deleteInvestDetail",value:function(e){e.delete()}},{key:"_upsertInvest",value:function(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=new te;return c.id=u,c.productId=e,c.productName=t,c.productType=re.getByCode(n),c.money=r,c.count=o,c.happenTime=i,c.buySellId=l,c.recordType=a,c.save()}}]),e}(),ae=ie,oe=(A.a.Option,T.a.Header,T.a.Content),le=(T.a.Sider,j.a.Title,j.a.Paragraph,j.a.Text),ue=(j.a.Link,function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).state={},r.incomeExpendColumns=[{title:"\u540d\u79f0",key:"title",dataIndex:"entity",render:function(e){var t="geekblue";return"\u4e3b\u52a8\u6536\u5165"===e.title||"\u88ab\u52a8\u6536\u5165"===e.title?t="volcano":"\u4e3b\u52a8\u652f\u51fa"!==e.title&&"\u88ab\u52a8\u652f\u51fa"!==e.title||(t="green"),Object(C.jsx)(R.a,{color:t,children:e.title},e.title)}},{title:"\u91d1\u989d",key:"money",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:g.getStr(e.money)})}}],r.subIncomeExpendColumns=[{title:"\u53d1\u751f\u65f6\u95f4",key:"happenTime",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:O.dayStr(e.happenTime)})}},{title:"\u540d\u79f0",key:"title",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:e.title})}},{title:"\u91d1\u989d",key:"money",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:g.getStr(e.money)})},sorter:function(e,t){return g.compare(e.entity.money,t.entity.money)}},{title:"\u63cf\u8ff0",key:"desc",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:e.desc})}},{title:"\u64cd\u4f5c",key:"action",render:function(e,t){if(!x.isNull(t.entity.id))return Object(C.jsx)(L.b,{size:"middle",children:Object(C.jsx)("a",{onClick:function(){r.deleteIncomeExpendDetail(t.entity.id)},children:"\u5220\u9664"})})}}],r.investColumns=[{title:"\u7c7b\u578b",key:"type",dataIndex:"entity",render:function(e){return Object(C.jsx)(R.a,{color:"volcano",children:e.info.productType.name},e.info.productType.code)}},{title:"\u540d\u79f0",key:"name",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:e.info.productName})}},{title:"\u5f53\u6708\u6295\u8d44",key:"currentMonthInvest",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(le,{children:g.getStr(null===(t=e.buySells)||void 0===t?void 0:t.currentMonthMoney)})},sorter:function(e,t){var n,r;return g.compare(null===(n=e.entity.buySells)||void 0===n?void 0:n.currentMonthMoney,null===(r=t.entity.buySells)||void 0===r?void 0:r.currentMonthMoney)}},{title:"\u6295\u8d44\u603b\u989d",key:"totalInvest",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(le,{children:g.getStr(null===(t=e.buySells)||void 0===t?void 0:t.totalMoney)})},sorter:function(e,t){var n,r;return g.compare(null===(n=e.entity.buySells)||void 0===n?void 0:n.totalMoney,null===(r=t.entity.buySells)||void 0===r?void 0:r.totalMoney)}},{title:"\u6700\u65b0\u4ef7\u503c",key:"lastPrice",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(le,{children:g.getStr(null===(t=e.currentPrice)||void 0===t?void 0:t.money)})},sorter:function(e,t){var n,r;return g.compare(null===(n=e.entity.currentPrice)||void 0===n?void 0:n.money,null===(r=t.entity.currentPrice)||void 0===r?void 0:r.money)}},{title:"\u5f53\u6708\u5165\u8d26\u5229\u6da6",key:"currentMonthProfit",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(le,{children:g.getStr(null===(t=e.profits)||void 0===t?void 0:t.currentMonthMoney)})},sorter:function(e,t){var n,r;return g.compare(null===(n=e.entity.profits)||void 0===n?void 0:n.currentMonthMoney,null===(r=t.entity.profits)||void 0===r?void 0:r.currentMonthMoney)}},{title:"\u8d26\u9762\u5229\u6da6",key:"totalProfit",dataIndex:"entity",render:function(e){var t,n,r=(null===(t=e.currentPrice)||void 0===t?void 0:t.money)-(null===(n=e.buySells)||void 0===n?void 0:n.totalMoney);return Object(C.jsx)(le,{children:g.getStr(r)})},sorter:function(e,t){var n,r,i,a,o=(null===(n=e.entity.currentPrice)||void 0===n?void 0:n.money)-(null===(r=e.entity.buySells)||void 0===r?void 0:r.totalMoney),l=(null===(i=t.entity.currentPrice)||void 0===i?void 0:i.money)-(null===(a=t.entity.buySells)||void 0===a?void 0:a.totalMoney);return g.compare(o,l)}},{title:"\u6210\u672c\u4ef7",key:"costPricePerCount",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(le,{children:g.getStr(g.safeDivision(null===(t=e.buySells)||void 0===t?void 0:t.totalMoney,e.buySells.totalCount))})}},{title:"\u73b0\u4ef7",key:"currentPricePerCount",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(le,{children:g.getStr(g.safeDivision(null===(t=e.currentPrice)||void 0===t?void 0:t.money,e.buySells.totalCount))})}},{title:"\u6700\u65b0\u65f6\u95f4",key:"happenTime",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(le,{children:O.dayStr(null===(t=e.currentPrice)||void 0===t?void 0:t.happenTime)})}}],r.subInvestColumns=[{title:"\u53d1\u751f\u65f6\u95f4",key:"happenTime",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:O.dayStr(e.happenTime)})}},{title:"\u4e70\u5165/\u5356\u51fa\u672c\u91d1",key:"principal",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:g.getStr(e.money)})}},{title:"\u5230\u8d26\u603b\u989d",key:"sellGetMoney",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:g.getStr(-1*e.money+e.profitMoney)})}},{title:"\u5229\u6da6",key:"profit",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:g.getStr(e.profitMoney)})}},{title:"\u6210\u672c\u4ef7",key:"costPricePerCount",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:g.getStr(g.safeDivision(Math.abs(e.money),Math.abs(e.count)))})}},{title:"\u5356\u51fa\u4ef7",key:"currentPricePerCount",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:g.getStr(g.safeDivision(Math.abs(-1*e.money+e.profitMoney),Math.abs(e.count)))})}},{title:"\u64cd\u4f5c",key:"action",render:function(e,t){return Object(C.jsx)(L.b,{size:"middle",children:Object(C.jsx)("a",{onClick:function(){r.deleteInvestDetail(t.entity)},children:"\u5220\u9664"})})}}],r.assetDebtColumns=[{title:"\u7c7b\u578b",key:"type",dataIndex:"entity",render:function(e){var t="geekblue";return e.info.productType.isDebt()&&(t="green"),Object(C.jsx)(R.a,{color:t,children:e.info.productType.name},e.info.productType.code)}},{title:"\u540d\u79f0",key:"name",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:e.info.productName})}},{title:"\u603b\u989d",key:"currentPrice",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(le,{children:g.getStr(null===(t=e.currentPrice)||void 0===t?void 0:t.money)})},sorter:function(e,t){var n,r;return g.compare(null===(n=e.entity.currentPrice)||void 0===n?void 0:n.money,null===(r=t.entity.currentPrice)||void 0===r?void 0:r.money)}},{title:"\u5f53\u6708\u5165\u8d26\u5229\u6da6",key:"currentMonthProfit",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(le,{children:g.getStr(null===(t=e.profits)||void 0===t?void 0:t.currentMonthMoney)})},sorter:function(e,t){var n,r;return g.compare(null===(n=e.entity.profits)||void 0===n?void 0:n.currentMonthMoney,null===(r=t.entity.profits)||void 0===r?void 0:r.currentMonthMoney)}},{title:"\u6700\u65b0\u65f6\u95f4",key:"happenTime",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(le,{children:O.dayStr(null===(t=e.currentPrice)||void 0===t?void 0:t.happenTime)})}}],r.subAssetDebtColumns=[{title:"\u53d1\u751f\u65f6\u95f4",key:"happenTime",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:O.dayStr(e.happenTime)})}},{title:"\u5165\u8d26\u5229\u6da6",key:"currentMonthProfit",dataIndex:"entity",render:function(e){return Object(C.jsx)(le,{children:g.getStr(e.money)})}},{title:"\u64cd\u4f5c",key:"action",render:function(e,t){return Object(C.jsx)(L.b,{size:"middle",children:Object(C.jsx)("a",{onClick:function(){r.deleteInvestDetail(t.entity)},children:"\u5220\u9664"})})}}],r}return Object(a.a)(n,[{key:"queryData",value:function(e){return I.queryMonth(e)}},{key:"insertData",value:function(e){try{var t,n=Q.getMoney(e,"money"),r=e.date;return I.upsert(n,D.getByCode(e.type),r,null!==(t=e.desc)&&void 0!==t?t:""),this.refreshPage(),!0}catch(i){return console.warn(i),alert(i),!1}}},{key:"queryAllInvestDataBefore",value:function(e){var t=ae.getAllInvestDetailBefore(O.monthEnd(e));return this._processInvestData(t.asset,e),this._processInvestData(t.debt,e),this._processInvestData(t.invest,e),t}},{key:"getLastMonthTotalMoney",value:function(e){var t=this.queryAllInvestDataBefore(O.lastMonthEnd(e)),n=this.dealInvestDetailList(t.asset,[]),r=this.dealInvestDetailList(t.debt,[]),i=this.dealInvestDetailList(t.invest,[]);return n[0]+r[0]+i[2]}},{key:"_processInvestData",value:function(e,t){for(var n=0,r=Object.keys(e);n<r.length;n++){var i=e[r[n]];x.isNull(i.profits)||function(){var e=0,n=[];i.profits.datas.forEach((function(r){O.inMonth(r.happenTime,t)&&(e+=r.money,n.push(r))})),i.profits.currentMonthMoney=e,i.profits.currentMonthDatas=n}(),x.isNull(i.buySells)||function(){var e=0,n=[];i.buySells.datas.forEach((function(r){O.inMonth(r.happenTime,t)&&(e+=r.money,n.push(r))})),i.buySells.currentMonthMoney=e,i.buySells.currentMonthDatas=n}()}}},{key:"addBuyInvest",value:function(e){var t=e.type,n=e.typeName,r=e.typeParentCode,i=Q.getMoney(e,"money"),a=Q.getMoney(e,"currentPrice"),o=e.count,l=e.date;return ae.addBuyInvest(t,n,r,o,i,a,l),this.refreshPage(),!0}},{key:"addSellInvest",value:function(e){var t=e.type,n=e.typeName,r=e.typeParentCode,i=e.count,a=Q.getMoney(e,"money"),o=Q.getMoney(e,"currentPrice"),l=Q.getMoney(e,"currentProfit"),u=Q.getMoney(e,"sellProfit"),c=e.date;if(x.notNumber(u)){if(x.notNumber(l))return N.b.error("\u5356\u51fa\u5229\u6da6 \u6216 \u8d26\u9762\u5229\u6da6 \u5fc5\u987b\u586b\u5199\u4e00\u4e2a\uff01"),!1;ae.addSellInvest(t,n,r,i,a,o,l,c)}else ae.addSellInvestOfProfit(t,n,r,i,a,u,o,c);return this.refreshPage(),!0}},{key:"addAssetDebtProfit",value:function(e){var t=e.type,n=e.typeName,r=e.typeParentCode,i=Q.getMoney(e,"money"),a=Q.getMoney(e,"currentPrice"),o=e.date;return ae.addAssetDebtProfit(t,n,r,i,a,o),this.refreshPage(),!0}},{key:"deleteInvestDetail",value:function(e){ae.deleteInvestDetail(e),this.refreshPage()}},{key:"deleteIncomeExpendDetail",value:function(e){I.delete(e),this.refreshPage()}},{key:"refreshPage",value:function(){this.setState({updateTime:(new Date).getTime()})}},{key:"createShowMoneyRowIfBiggerThan",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r="",i=Math.abs(t);return void 0!==n[0]&&(r=i>100*n[1]?"danger":i>100*n[0]?"warning":"success"),this.createShowTextRow(e,g.getStr(t),r)}},{key:"createShowMoneyRowIfSmallerThan",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r="",i=Math.abs(t);return void 0!==n[0]&&(r=i<100*n[1]?"danger":i<100*n[0]?"warning":"success"),this.createShowTextRow(e,g.getStr(t),r)}},{key:"createShowMoneyRow",value:function(e,t){return this.createShowTextRow(e,g.getStr(t),"")}},{key:"createShowTextRow",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return Object(C.jsxs)(_.a,{align:"middle",style:{margin:"0 10px",padding:"4px 0"},children:[Object(C.jsx)(q.a,{span:12,children:Object(C.jsx)(le,{type:n,strong:!0,children:e})}),Object(C.jsx)(q.a,{span:12,align:"right",children:Object(C.jsx)(le,{type:n,strong:!0,children:t})})]})}},{key:"newEntityFromDetail",value:function(e){return{id:e.id,happenTime:e.happenTime,title:e.type.name,money:e.money,desc:e.desc}}},{key:"newEntity",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return{happenTime:e,title:t,money:n,desc:r,child:i}}},{key:"dealInvestDetailList",value:function(e,t){for(var n=0,r=0,i=0,a=0,o=Object.keys(e);a<o.length;a++){var l=e[o[a]];x.isNull(l.currentPrice)||(n+=l.currentPrice.money),x.isNull(l.profits)||0!==l.profits.currentMonthMoney&&(t.push(this.newEntity(l.info.happenTime,l.info.productName,l.profits.currentMonthMoney,null)),i+=l.profits.currentMonthMoney),x.isNull(l.buySells)||(r+=l.buySells.totalMoney)}return[n,i,r]}},{key:"render",value:function(){var e=this,t=new Date(this.props.month);if(x.notNumber(t))return Object(C.jsx)(oe,{});console.log("month page render "+this.props.month);var n={},r={};D.toList(I.getExpenditureTypes()).forEach((function(e){n[e.code]=[e.name]})),D.toList(I.getIncomeTypes()).forEach((function(e){r[e.code]=[e.name]}));var i={},a={},o={};ae.queryProducts().forEach((function(e){e.type.isAsset()?a[e.id]=[e.name,e.type.code,e.type.name]:e.type.isDebt()?o[e.id]=[e.name,e.type.code,e.type.name]:i[e.id]=[e.name,e.type.code,e.type.name]}));var l=[],u=0,c=0,s=[],d=[];this.queryData(t).sort((function(e,t){return Math.abs(e.type.code)>Math.abs(t.type.code)?1:-1})).forEach((function(t){t.type.code>0?(s.push(e.newEntityFromDetail(t)),u+=t.money):(d.push(e.newEntityFromDetail(t)),c+=t.money)}));var y=this.queryAllInvestDataBefore(t),h=[],f=[],v=this.dealInvestDetailList(y.asset,h),p=this.dealInvestDetailList(y.debt,f),b=this.dealInvestDetailList(y.invest,h),m=this.getLastMonthTotalMoney(t),j=v[0]+p[0]+b[2],O=u+c+v[1]+b[1]+p[1];l.push({key:"\u4e3b\u52a8\u6536\u5165",entity:this.newEntity(null,"\u4e3b\u52a8\u6536\u5165",u,null,s)}),l.push({key:"\u88ab\u52a8\u6536\u5165",entity:this.newEntity(null,"\u88ab\u52a8\u6536\u5165",v[1]+b[1],null,h)}),l.push({key:"\u4e3b\u52a8\u652f\u51fa",entity:this.newEntity(null,"\u4e3b\u52a8\u652f\u51fa",c,null,d)}),l.push({key:"\u88ab\u52a8\u652f\u51fa",entity:this.newEntity(null,"\u88ab\u52a8\u652f\u51fa",p[1],null,f)}),l.push({key:"\u65b0\u589e\u73b0\u91d1",entity:this.newEntity(null,"\u65b0\u589e\u73b0\u91d1",O,null)}),l.push({key:"\u4e0a\u671f\u603b\u8d44\u4ea7",entity:this.newEntity(null,"\u4e0a\u671f\u603b\u8d44\u4ea7",m,null)});var S=[];S.push(this.newEntity(null,"\u8d44\u4ea7\u603b\u989d",v[0],null)),S.push(this.newEntity(null,"\u8d1f\u503a\u603b\u989d",p[0],null)),S.push(this.newEntity(null,"\u6295\u8d44\u603b\u989d",b[2],"\u8d26\u9762\u4ef7\u503c\uff1a".concat(g.getStr(b[0])))),l.push({key:"\u5f53\u524d\u603b\u8d44\u4ea7",entity:this.newEntity(null,"\u5f53\u524d\u603b\u8d44\u4ea7",j,null,S)});for(var w=[],M=0,P=Object.keys(y.invest);M<P.length;M++){var T=P[M],N=y.invest[T];w.push({key:T,entity:N})}for(var E=[],B=0,A=Object.keys(y.asset);B<A.length;B++){var R=A[B],L=y.asset[R];E.push({key:R,entity:L})}for(var F=0,z=Object.keys(y.debt);F<z.length;F++){var H=z[F],Y=y.debt[H];E.push({key:H,entity:Y})}return Object(C.jsxs)(oe,{className:"Content",children:[Object(C.jsxs)(_.a,{justify:"space-between",style:{padding:"10px 5px",backgroundColor:"#eee"},children:[Object(C.jsx)(V.a,{orientation:"center",children:"\u65b0\u589e\u6536\u5165/\u652f\u51fa"}),Object(C.jsxs)(q.a,{span:8,children:[Object(C.jsx)(Q,{title:"\u6536\u5165",cfgs:[{name:"type",code2Name:r,required:!0},{name:"money",required:!0,moneyPon:!0},{name:"date",required:!0,inMonth:this.props.month},{name:"desc"}],onSubmit:function(t){return e.insertData(t)}}),Object(C.jsx)(Q,{title:"\u652f\u51fa",cfgs:[{name:"type",code2Name:n,required:!0},{name:"money",required:!0,moneyPon:!1},{name:"date",required:!0,inMonth:this.props.month},{name:"desc"}],onSubmit:function(t){return e.insertData(t)}})]}),Object(C.jsxs)(q.a,{span:16,children:[Object(C.jsx)(K.a,{columns:this.incomeExpendColumns,dataSource:l,expandable:{expandedRowRender:function(t,n){var r=[];return t.entity.child.forEach((function(e){r.push({key:x.isNull(e.id)?e.title:e.id,entity:e})})),Object(C.jsx)(K.a,{columns:e.subIncomeExpendColumns,dataSource:r,pagination:!1,sortDirections:["descend"]})},rowExpandable:function(e){return!x.isNull(e.entity.child)&&e.entity.child.length>0}},pagination:{pageSize:20},sortDirections:["descend"]}),Object(C.jsx)(V.a,{orientation:"center",children:"\u6307\u6807"}),this.createShowTextRow("\u88ab\u52a8\u6536\u5165/\u4e3b\u52a8\u6536\u5165",x.getPercent(v[1]/u)),this.createShowTextRow("\u88ab\u52a8\u6536\u5165/\u4e3b\u52a8\u652f\u51fa",x.getPercent(v[1]/Math.abs(c))),this.createShowMoneyRowIfBiggerThan("\u603b\u8d44\u4ea7\u73af\u6bd4\u8bef\u5dee",j-m-O,[500,1e3])]})]}),Object(C.jsxs)(_.a,{justify:"space-between",style:{padding:"10px 5px",backgroundColor:"#eee"},children:[Object(C.jsx)(V.a,{orientation:"center",children:"\u8d44\u4ea7/\u8d1f\u503a"}),Object(C.jsxs)(q.a,{span:8,children:[Object(C.jsx)(Q,{title:"\u8d44\u4ea7",cfgs:[{name:"type",code2Name:a,required:!0},{name:"currentPrice",hint:"\u8d26\u9762\u4ef7\u503c",required:!0,moneyPon:!0},{name:"money",hint:"\u6536\u76ca",moneyPon:!0},{name:"date",required:!0,inMonth:this.props.month}],onSubmit:function(t){return e.addAssetDebtProfit(t)}}),Object(C.jsx)(Q,{title:"\u8d1f\u503a",cfgs:[{name:"type",code2Name:o,required:!0},{name:"currentPrice",hint:"\u8d26\u9762\u4ef7\u503c",required:!0,moneyPon:!1},{name:"money",hint:"\u4e8f\u635f",moneyPon:!1},{name:"date",required:!0,inMonth:this.props.month}],onSubmit:function(t){return e.addAssetDebtProfit(t)}})]}),Object(C.jsx)(q.a,{span:16,children:Object(C.jsx)(K.a,{columns:this.assetDebtColumns,dataSource:E,expandable:{expandedRowRender:function(t,n){var r=[];return t.entity.profits.currentMonthDatas.forEach((function(e){r.push({key:e.id,entity:e})})),Object(C.jsx)(K.a,{columns:e.subAssetDebtColumns,dataSource:r,pagination:!1})},rowExpandable:function(e){var t,n;return!x.isNull(null===(t=e.entity.profits)||void 0===t?void 0:t.currentMonthDatas)&&(null===(n=e.entity.profits)||void 0===n?void 0:n.currentMonthDatas.length)>0}},pagination:{pageSize:20},scroll:{x:1e3},sortDirections:["descend"]})})]}),Object(C.jsxs)(_.a,{style:{padding:"10px 5px",backgroundColor:"#eee"},children:[Object(C.jsx)(V.a,{orientation:"center",children:"\u6295\u8d44"}),Object(C.jsxs)(q.a,{span:8,children:[Object(C.jsx)(Q,{title:"\u4e70\u5165\u6295\u8d44",cfgs:[{name:"type",code2Name:i,required:!0},{name:"money",hint:"\u82b1\u8d39\u91d1\u989d",required:!0,moneyPon:!0},{name:"currentPrice",hint:"\u8d26\u9762\u4ef7\u503c",required:!0,moneyPon:!0},{name:"count",hint:"\u4efd\u6570",required:!1,moneyPon:!0},{name:"date",required:!0,inMonth:this.props.month}],onSubmit:function(t){return e.addBuyInvest(t)}}),Object(C.jsx)(Q,{title:"\u5356\u51fa\u6295\u8d44",cfgs:[{name:"type",code2Name:i,required:!0},{name:"count",hint:"\u4efd\u6570",required:!1,moneyPon:!0},{name:"money",hint:"\u5356\u51fa\u6240\u5f97\u91d1\u989d",required:!0,moneyPon:!0},{name:"sellProfit",hint:"\u5356\u51fa\u5229\u6da6-\u53ef\u8d1f\uff08\u4e8c\u9009\u4e00\uff09",required:!1,moneyPon:!0},{name:"currentPrice",hint:"\u8d26\u9762\u4ef7\u503c",required:!0,moneyPon:!0},{name:"currentProfit",hint:"\u8d26\u9762\u5229\u6da6-\u53ef\u8d1f\uff08\u4e8c\u9009\u4e00\uff09",required:!1,moneyPon:!0},{name:"date",required:!0,inMonth:this.props.month}],onSubmit:function(t){return e.addSellInvest(t)}})]}),Object(C.jsx)(q.a,{span:16,children:Object(C.jsx)(K.a,{columns:this.investColumns,dataSource:w,expandable:{expandedRowRender:function(t,n){var r=[];return t.entity.buySells.currentMonthDatas.forEach((function(e){var n,i,a,o=Object(k.a)(null!==(n=null===(i=t.entity.profits)||void 0===i?void 0:i.currentMonthDatas)&&void 0!==n?n:[]);try{for(o.s();!(a=o.n()).done;){var l=a.value;if(l.buySellId===e.id){e.profitMoney=l.money;break}}}catch(u){o.e(u)}finally{o.f()}r.push({key:e.id,entity:e})})),Object(C.jsx)(K.a,{columns:e.subInvestColumns,dataSource:r,pagination:!1})},rowExpandable:function(e){var t,n;return!x.isNull(null===(t=e.entity.buySells)||void 0===t?void 0:t.currentMonthDatas)&&(null===(n=e.entity.buySells)||void 0===n?void 0:n.currentMonthDatas.length)>0}},pagination:{pageSize:20},scroll:{x:1e3},sortDirections:["descend"]})})]})]})}}]),n}(c.a.Component)),ce=ue,se=(A.a.Option,T.a.Header,T.a.Content),de=(T.a.Sider,j.a.Title,j.a.Paragraph,j.a.Text),ye=(j.a.Link,function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){return Object(i.a)(this,n),t.call(this,e)}return Object(a.a)(n,[{key:"render",value:function(){return Object(C.jsx)(se,{className:"Content",children:Object(C.jsx)(de,{style:{fontSize:"50px"},children:" TODO "})})}}]),n}(c.a.Component)),he=n(478),fe=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).state={},r}return Object(a.a)(n,[{key:"render",value:function(){var e=this,t=this.props.title,n=this.props.visible,r=this.props.cfgs;return Object(C.jsx)(he.a,{title:t,visible:n,footer:null,onCancel:function(){return e.props.onCancel()},children:Object(C.jsx)(Q,{title:"",cfgs:r,onSubmit:function(t){return e.props.onOk(t)}},this.props.key)})}}]),n}(c.a.Component),ve=(A.a.Option,T.a.Header,T.a.Content),pe=(T.a.Sider,j.a.Title,j.a.Paragraph,j.a.Text),be=(j.a.Link,function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).state={},r.investColumns=[{title:"\u7c7b\u578b",key:"type",dataIndex:"entity",render:function(e){return Object(C.jsx)(R.a,{color:"volcano",children:e.info.productType.name},e.info.productType.code)}},{title:"\u540d\u79f0",key:"name",dataIndex:"entity",render:function(e){return Object(C.jsx)(pe,{children:e.info.productName})}},{title:"\u6295\u8d44\u603b\u989d",key:"totalInvest",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(pe,{children:g.getStr(null===(t=e.buySells)||void 0===t?void 0:t.totalMoney)})},sorter:function(e,t){var n,r;return g.compare(null===(n=e.entity.buySells)||void 0===n?void 0:n.totalMoney,null===(r=t.entity.buySells)||void 0===r?void 0:r.totalMoney)}},{title:"\u6700\u65b0\u4ef7\u503c",key:"lastPrice",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(pe,{children:g.getStr(null===(t=e.currentPrice)||void 0===t?void 0:t.money)})},sorter:function(e,t){var n,r;return g.compare(null===(n=e.entity.currentPrice)||void 0===n?void 0:n.money,null===(r=t.entity.currentPrice)||void 0===r?void 0:r.money)}},{title:"\u8d26\u9762\u5229\u6da6",key:"totalProfit",dataIndex:"entity",render:function(e){var t,n,r=(null===(t=e.currentPrice)||void 0===t?void 0:t.money)-(null===(n=e.buySells)||void 0===n?void 0:n.totalMoney);return Object(C.jsx)(pe,{children:g.getStr(r)})},sorter:function(e,t){var n,r,i,a,o=(null===(n=e.entity.currentPrice)||void 0===n?void 0:n.money)-(null===(r=e.entity.buySells)||void 0===r?void 0:r.totalMoney),l=(null===(i=t.entity.currentPrice)||void 0===i?void 0:i.money)-(null===(a=t.entity.buySells)||void 0===a?void 0:a.totalMoney);return g.compare(o,l)}},{title:"\u4efd\u6570",key:"totalCount",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(pe,{children:null===(t=e.buySells)||void 0===t?void 0:t.totalCount})}},{title:"\u6210\u672c\u4ef7",key:"costPricePerCount",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(pe,{children:g.getStr(g.safeDivision(null===(t=e.buySells)||void 0===t?void 0:t.totalMoney,e.buySells.totalCount))})}},{title:"\u73b0\u4ef7",key:"currentPricePerCount",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(pe,{children:g.getStr(g.safeDivision(null===(t=e.currentPrice)||void 0===t?void 0:t.money,e.buySells.totalCount))})}},{title:"\u6700\u65b0\u65f6\u95f4",key:"happenTime",dataIndex:"entity",render:function(e){var t;return Object(C.jsx)(pe,{children:O.dayStr(null===(t=e.currentPrice)||void 0===t?void 0:t.happenTime)})}}],r.subInvestColumns=[{title:"\u53d1\u751f\u65f6\u95f4",key:"happenTime",dataIndex:"entity",render:function(e){return Object(C.jsx)(pe,{children:O.dayStr(e.happenTime)})}},{title:"\u4e70\u5165/\u5356\u51fa\u672c\u91d1",key:"principal",dataIndex:"entity",render:function(e){return Object(C.jsx)(pe,{children:g.getStr(e.money)})}},{title:"\u5230\u8d26\u603b\u989d",key:"sellGetMoney",dataIndex:"entity",render:function(e){return Object(C.jsx)(pe,{children:g.getStr(-1*e.money+e.profitMoney)})}},{title:"\u5229\u6da6",key:"profit",dataIndex:"entity",render:function(e){return Object(C.jsx)(pe,{children:g.getStr(e.profitMoney)})}},{title:"\u4efd\u6570",key:"totalCount",dataIndex:"entity",render:function(e){return Object(C.jsx)(pe,{children:Math.abs(e.count)})}},{title:"\u6210\u672c\u4ef7",key:"costPricePerCount",dataIndex:"entity",render:function(e){return Object(C.jsx)(pe,{children:g.getStr(g.safeDivision(Math.abs(e.money),Math.abs(e.count)))})}},{title:"\u5356\u51fa\u4ef7",key:"currentPricePerCount",dataIndex:"entity",render:function(e){return Object(C.jsx)(pe,{children:g.getStr(g.safeDivision(Math.abs(-1*e.money+e.profitMoney),Math.abs(e.count)))})}},{title:"\u64cd\u4f5c",key:"action",render:function(e,t){return Object(C.jsx)(L.b,{size:"middle",children:Object(C.jsx)("a",{onClick:function(){r.deleteInvestDetail(t.entity)},children:"\u5220\u9664"})})}}],r.productColumns=[{title:"\u7c7b\u578b",key:"type",dataIndex:"entity",render:function(e){var t,n,r,i,a="volcano";return null!==(t=e.type)&&void 0!==t&&t.isAsset()?a="geekblue":null!==(n=e.type)&&void 0!==n&&n.isDebt()&&(a="green"),Object(C.jsx)(R.a,{color:a,children:null===(i=e.type)||void 0===i?void 0:i.name},null===(r=e.type)||void 0===r?void 0:r.code)}},{title:"\u540d\u79f0",key:"name",dataIndex:"entity",render:function(e){return Object(C.jsx)(pe,{children:e.name})}},{title:"\u5b9a\u6295\u989d",key:"fixVote",dataIndex:"entity",render:function(e){return Object(C.jsx)(pe,{children:g.getStr(e.fixVote)})}},{title:"\u63cf\u8ff0",key:"desc",dataIndex:"entity",render:function(e){return Object(C.jsx)(pe,{children:e.desc})}},{title:"\u64cd\u4f5c",key:"action",render:function(e,t){return Object(C.jsxs)(L.b,{size:"middle",children:[Object(C.jsx)("a",{onClick:function(){r.showEditProductDialog(t.entity)},children:"\u7f16\u8f91"}),Object(C.jsx)("a",{onClick:function(){r.deleteProduct(t.entity)},children:"\u5220\u9664"})]})}}],r}return Object(a.a)(n,[{key:"showEditProductDialog",value:function(e){this.setState({showDialog:"editProduct",currentProduct:e})}},{key:"editProduct",value:function(e,t){ae.editProduct(e,t.desc,Q.getMoney(t,"money")),this.hideDialog()}},{key:"hideDialog",value:function(){this.setState({showDialog:"",currentProduct:null})}},{key:"deleteInvestDetail",value:function(e){ae.deleteInvestDetail(e),this.refreshPage()}},{key:"refreshPage",value:function(){this.setState({updateTime:(new Date).getTime()})}},{key:"addProduct",value:function(e){ae.upsertProduct(e.type,e.name,e.desc),this.refreshPage()}},{key:"queryProducts",value:function(){return ae.queryProducts()}},{key:"deleteProduct",value:function(e){ae.deleteProduct(e),this.refreshPage()}},{key:"queryAllInvestData",value:function(){var e=ae.getAllInvestDetailBefore(null);return this._processInvestData(e.invest),e}},{key:"_processInvestData",value:function(e){for(var t=0,n=Object.keys(e);t<n.length;t++)e[n[t]]}},{key:"render",value:function(){var e,t,n,r=this;console.log("invest page render");var i={};ae.getProductTypes().forEach((function(e){i[e.code]=[e.name]}));var a=[];ae.queryProducts().sort((function(e,t){return Math.abs(e.type.code)<Math.abs(t.type.code)?1:-1})).forEach((function(e){a.push({key:e.id,entity:e})}));for(var o=this.queryAllInvestData(),l=[],u=0,c=Object.keys(o.invest);u<c.length;u++){var s=c[u],d=o.invest[s];l.push({key:s,entity:d})}return Object(C.jsxs)(ve,{className:"Content",children:[Object(C.jsx)(K.a,{columns:this.investColumns,dataSource:l,expandable:{expandedRowRender:function(e,t){var n=[];return console.log(e.entity),e.entity.buySells.datas.forEach((function(t){var r,i,a,o=Object(k.a)(null!==(r=null===(i=e.entity.profits)||void 0===i?void 0:i.datas)&&void 0!==r?r:[]);try{for(o.s();!(a=o.n()).done;){var l=a.value;if(l.buySellId===t.id){t.profitMoney=l.money;break}}}catch(u){o.e(u)}finally{o.f()}n.push({key:t.id,entity:t})})),Object(C.jsx)(K.a,{columns:r.subInvestColumns,dataSource:n,pagination:!1})},rowExpandable:function(e){var t;return!x.isNull(null===(t=e.entity.buySells)||void 0===t?void 0:t.datas)}},pagination:{pageSize:20},scroll:{x:1400},sortDirections:["descend"]}),Object(C.jsxs)(_.a,{style:{padding:"10px 5px",backgroundColor:"#eee"},children:[Object(C.jsx)(q.a,{span:8,children:Object(C.jsx)(Q,{title:"\u65b0\u589e\u6295\u8d44\u4ea7\u54c1",cfgs:[{name:"type",code2Name:i,required:!0},{name:"name",required:!0},{name:"desc"}],onSubmit:function(e){return r.addProduct(e),!0}})}),Object(C.jsx)(q.a,{span:16,children:Object(C.jsx)(K.a,{columns:this.productColumns,dataSource:a,pagination:{pageSize:20}})})]}),Object(C.jsx)(fe,{title:"\u4fee\u6539\u4ea7\u54c1",visible:"editProduct"===this.state.showDialog,cfgs:[{name:"money",hint:"\u5b9a\u6295\u989d",defaultValue:(null===(t=this.state.currentProduct)||void 0===t?void 0:t.fixVote)/100,moneyPon:!0},{name:"desc",defaultValue:null===(n=this.state.currentProduct)||void 0===n?void 0:n.desc}],onOk:function(e){return r.editProduct(r.state.currentProduct,e)},onCancel:function(){return r.hideDialog()}},null===(e=this.state.currentProduct)||void 0===e?void 0:e.id)]})}}]),n}(c.a.Component)),me=(A.a.Option,T.a.Header,T.a.Content),je=(T.a.Sider,j.a.Title,j.a.Paragraph,j.a.Text),ge=(j.a.Link,function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).state={},r}return Object(a.a)(n,[{key:"refreshDB",value:function(){var e=Object(r.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_e.initDb(t[0]);case 2:console.log(t[0]),this.props.onDbReady();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e;null===(e=_e.db)||void 0===e||e.export()}},{key:"click1",value:function(){}},{key:"click2",value:function(){}},{key:"render",value:function(){var e=this;return Object(C.jsxs)(me,{className:"Content",children:[Object(C.jsxs)(_.a,{style:{padding:"10px 50px 50px",backgroundColor:"#eee"},children:[Object(C.jsxs)(q.a,{span:12,align:"center",children:[Object(C.jsx)(V.a,{orientation:"center",children:"\u52a0\u8f7dDB\u6587\u4ef61111"}),Object(C.jsx)(je,{children:this.state.fileName}),Object(C.jsx)("input",{type:"file",id:"dbfile",accept:".db",onChange:function(t){return e.refreshDB(t.target.files)}})]}),Object(C.jsxs)(q.a,{span:12,align:"center",children:[Object(C.jsx)(V.a,{orientation:"center",children:"\u5bfc\u51faDB\u6587\u4ef6"}),Object(C.jsx)(p.a,{onClick:function(){return e.export()},children:"\u4fdd\u5b58DB"})]})]}),Object(C.jsxs)(_.a,{style:{padding:"10px 50px 50px",backgroundColor:"#eee",margin:"10px 0"},children:[Object(C.jsx)(V.a,{orientation:"center",children:"\u6d4b\u8bd5\u6309\u94ae"}),Object(C.jsx)(p.a,{onClick:function(){return e.click1()},children:"click1"}),Object(C.jsx)(p.a,{onClick:function(){return e.click2()},children:"click2"}),Object(C.jsx)(Q,{title:"\u6d4b\u8bd5",cfgs:[{name:"date",hint:"\u6708\u4efd",picker:"month",defaultValue:new Date}],onSubmit:function(e){return console.log(e),!0}})]})]})}}]),n}(c.a.Component)),xe=ge,Oe=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).tablename="data_summary",e}return Object(a.a)(n,[{key:"upsert",value:function(e){var t,n,r=S.getDateStr(e.gmtCreate,!0),i=S.getDateStr(e.gmtModified);null==e.id?null===(t=_e.db)||void 0===t||t.insert(this.tablename,["gmt_create","gmt_modified","type","time","money"],[r,i,e.type.code,e.time.timeStr(),e.money]):null===(n=_e.db)||void 0===n||n.update(this.tablename,e.id,["gmt_create","gmt_modified","type","time","money"],[r,i,e.type.code,e.time.timeStr(),e.money])}},{key:"selectAllMonthKey",value:function(){var e;return this.convert(null===(e=_e.db)||void 0===e?void 0:e.select(this.tablename,["type"],[Se.BY_MONTH_KEY.code],["="]))}},{key:"convert",value:function(e){var t=[];if(void 0===e||void 0===e[0])return t;var n,r=Object(k.a)(e[0].values);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=new ke;a.id=i[0],a.gmtCreate=new Date(i[1]),a.gmtModified=new Date(i[2]),a.type=Se.getByCode(i[3]),a.time=new Date(i[4]),a.money=i[5],t.push(a)}}catch(o){r.e(o)}finally{r.f()}return t}}]),n}(S),ke=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).type=null,e.time=null,e.money=null,e}return Object(a.a)(n,[{key:"save",value:function(){this.gmtModified=new Date,n.repo.upsert(this)}}],[{key:"queryAllMonthKey",value:function(){return this.repo.selectAllMonthKey()}},{key:"delete",value:function(e){this.repo.delete(e)}}]),n}(w);ke.repo=new Oe;var Se=function(){function e(t,n){Object(i.a)(this,e),this.code=t,this.name=n}return Object(a.a)(e,null,[{key:"getByCode",value:function(e){var t,n=Object(k.a)(this.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.code==e)return r}}catch(i){n.e(i)}finally{n.f()}return null}},{key:"values",value:function(){return[this.BY_MONTH_KEY]}}]),e}();Se.BY_MONTH_KEY=new Se(1,"\u6309\u6708\u5c55\u793a\u7684\u53ef\u7528\u6708\u4efd");var we=function(){function e(){Object(i.a)(this,e)}return Object(a.a)(e,null,[{key:"addMonth",value:function(e){var t=new ke;t.type=Se.BY_MONTH_KEY,t.time=O.monthStart(e),t.save()}},{key:"queryMonths",value:function(){var e=ke.queryAllMonthKey();return console.log(e),e.map((function(e){return O.monthStr(e.time)}))}}]),e}(),Me=T.a.Header,Pe=(T.a.Content,T.a.Sider),De=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).navItems=["init","by_month","invest_detail","todo"].map((function(e){switch(e){case"init":return{key:e,label:"\u6570\u636e\u521d\u59cb\u5316"};case"by_month":return{key:e,label:"\u6309\u6708\u5c55\u793a"};case"invest_detail":return{key:e,label:"\u6295\u8d44\u8be6\u60c5"};default:return{key:e,label:"TODO"}}})),r.state={navKey:"init"},r}return Object(a.a)(n,[{key:"refreshPage",value:function(){this.setState({updateTime:(new Date).getTime()})}},{key:"getByMonthSideDatas",value:function(){var e=we.queryMonths();this.months=e;var t={};return e.forEach((function(e){var n=e.substring(0,4);x.isNull(t[n])&&(t[n]=[]),t[n].push(e)})),console.log(t),t}},{key:"showAddNewMonthDialog",value:function(){this.setState({showDialog:"addNewMonth"})}},{key:"addNewMoth",value:function(e){isNaN(e)?N.b.error("\u8bf7\u8f93\u5165\u6709\u6548\u6708\u4efd\uff0c\u5982 2022-5"):this.months.includes(O.monthStr(e))?(N.b.error("\u5df2\u6709\u5f53\u524d\u6708\u4efd"),this.hideDialog()):(we.addMonth(e),this.state.sideKey=O.monthStr(e),this.hideDialog())}},{key:"hideDialog",value:function(){this.setState({showDialog:""})}},{key:"render",value:function(){var e=this,t=this.state.navKey,n=[],r=[],i=null,a=[];if("init"===t||!0!==this.state.dbReady)"init"!==t&&(this.state.navKey="init",N.b.error("\u8bf7\u5148\u52a0\u8f7dDB")),i=Object(C.jsx)(xe,{onDbReady:function(){e.state.dbReady=!0,e.state.navKey="by_month",e.refreshPage()}});else if("by_month"===t){var o=this.getByMonthSideDatas(),l=null;n=Object.keys(o).sort((function(e,t){return t>e?1:-1})).map((function(e,t){return a.push(e),{key:e,label:e,children:o[e].sort((function(e,t){return t>e?1:-1})).map((function(e,t){return null==l&&(l=e),{key:e,label:e}}))}})),x.isNull(this.state.sideKey)&&(this.state.sideKey=l),r.push(Object(C.jsx)(p.a,{onClick:function(){return e.showAddNewMonthDialog()},children:"\u65b0\u52a0\u6708\u4efd"})),i=Object(C.jsx)(ce,{month:this.state.sideKey})}else i="invest_detail"===t?Object(C.jsx)(be,{}):Object(C.jsx)(ye,{});return Object(C.jsxs)(T.a,{children:[Object(C.jsx)(Me,{className:"header",children:Object(C.jsx)(E.a,{theme:"dark",mode:"horizontal",items:this.navItems,selectedKeys:[t],onSelect:function(t){e.setState((function(){return e.state.navKey=t.key}))}})}),Object(C.jsxs)(T.a,{children:[Object(C.jsx)(Pe,{width:200,className:"site-layout-background",children:Object(C.jsx)(E.a,{className:"Menu",mode:"inline",openKeys:a,selectedKeys:[this.state.sideKey],items:n,onSelect:function(t){e.setState((function(){return e.state.sideKey=t.key}))}})}),Object(C.jsxs)(T.a,{className:"Layout-inner",children:[Object(C.jsxs)(_.a,{align:"middle",children:[Object(C.jsx)(q.a,{flex:"auto",children:Object(C.jsxs)(B.a,{children:[Object(C.jsx)(B.a.Item,{children:this.state.navKey}),Object(C.jsx)(B.a.Item,{children:this.state.sideKey})]})}),Object(C.jsx)(q.a,{span:12,align:"right",children:r})]}),i]}),Object(C.jsx)(fe,{title:"\u65b0\u52a0\u6708\u4efd",visible:"addNewMonth"===this.state.showDialog,cfgs:[{name:"date",hint:"\u6708\u4efd",picker:"month",defaultValue:new Date}],onOk:function(t){return e.addNewMoth(t.date)},onCancel:function(){return e.hideDialog()}})]})]})}}]),n}(c.a.Component),Ie=n(269),Ce=(n(464),n(272)),Te=n.n(Ce),Ne=n(17);J.a.locale("zh-cn"),d.a.render(Object(C.jsx)(Ne.a,{locale:Te.a,children:Object(C.jsx)(De,{},"mainpage")}),document.getElementById("root"));var Ee=!1,_e=function(){function e(){Object(i.a)(this,e)}return Object(a.a)(e,null,[{key:"initDb",value:function(){var e=Object(r.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.db=new Ie.a,e.next=3,this.db.init(t);case 3:Ee=!0;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();_e.db=null}},[[469,1,2]]]);
//# sourceMappingURL=main.973e10e3.chunk.js.map